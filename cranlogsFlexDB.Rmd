---
title: "cranLogs"
author: "myTinyShinys"
output: 
  flexdashboard::flex_dashboard:
    css: styles.css
    theme: united
    orientation: rows
    social: [ menu ]
    source_code: embed
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(plotly)
library(readr)

library(shiny)

library(feather)
library(dplyr)

# Import data
df <- read_feather("data/allCranLogs.feather")
pkgs <- read_csv("data/packages.csv")

# for use in selectInputs
packageChoice <- pkgs$name



```


Individual Packages
===================================== 

Inputs {.sidebar data-width=250}
-------------------------------------

``` {r}
# some background
includeMarkdown("info.md")
hr()
# interactive
selectInput(
"packages_Ind",
"Select (default dplyr)",
choices = packageChoice,
selected = "dplyr",
multiple = FALSE,
selectize = FALSE,
size = 10
)

```

``` {r data carpentry individual}

# saves repeating calculations
indData <- reactive({
data <-   df %>%
filter(package == input$packages_Ind & count > 0) %>%
arrange(rank)

downloads <- data %>%
summarize(tot = sum(count))

info = list(data = data, downloads = downloads)
return(info)
  
})

```

Row
-----------------------------------------------------------------------

### Package 

```{r}

renderValueBox({
  val <-
  paste0(input$packages_Ind, " - ", pkgs[pkgs$name == input$packages_Ind, ]$description)
  
  valueBox(value = val,
  icon = "fa-book")
  
  })



```


Row
-----------------------------------------------------------------------

### Daily Downloads 

```{r}


renderPlotly({
  indData()$data %>%
  plot_ly(
  x = date,
  y = count,
  mode = "markers",
  marker = list(color = "#007bff", size = 3),
  hoverinfo = "text",
  text = paste0(date, "<br> Count: ", count, "<br> Rank: ", rank)
  )  %>%
  
  layout(
  hovermode = "closest",
  xaxis = list(title = ""),
  yaxis = list(title = " ")
  )
  })


```


### Rank

```{r}

renderPlotly({
  indData()$data %>%
  plot_ly(
  x = date,
  y = rank,
  mode = "markers",
  marker = list(color = "#ff9000", size = 3),
  hoverinfo = "text",
  text = paste0(date, "<br> Rank: ", rank, "<br> Count: ", count)
  )  %>%
  layout(xaxis = list(title = ""),
  yaxis = list(autorange = "reversed", title = ""))
  })
  


```



Row
-----------------------------------------------------------------------

### Total Downloads

```{r}

renderValueBox({
  valueBox(value = format(indData()$downloads$tot, big.mark = ","),
  icon = "fa-download")
  
  })



```

### Highest Rank

```{r}

renderValueBox({
  valueBox(value = format(indData()$data$rank[1], big.mark = ","),
  icon = "fa-thumbs-up")
  
  })



```

Multiple Packages
===================================== 

Inputs {.sidebar data-width=250}
-------------------------------------

``` {r}
includeMarkdown("info.md")
hr()
selectInput("packages_Mult","Select or Start Typing ",choices=packageChoice,selected=c("rbokeh","ggvis","plotly","iplots","rggobi","googlevis"), multiple=TRUE)

```

Column {data-width=650}
-----------------------------------------------------------------------

### Daily Downloads - Zoom as required and Hover for details

```{r}


renderPlotly({
  df %>%
  filter(package %in% input$packages_Mult) %>%
  plot_ly(
  x = date,
  y = count,
  mode = "markers",
  color = package
  )  %>%
  layout(xaxis = list(title = ""),
  yaxis = list(title = ""))
  })


```


